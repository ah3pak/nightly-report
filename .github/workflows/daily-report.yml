name: Daily Telegram Report

on:
  schedule:
    - cron: "30 17 * * *"   # 21:00 ØªÙ‡Ø±Ø§Ù†
  workflow_dispatch: {}      # Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ

jobs:
  send:
    runs-on: ubuntu-latest

    steps:
      - name: Build message (safe)
        id: build
        run: |
          python3 - <<'PY'
          from datetime import datetime, timedelta
          import json, os
          # Ø²Ù…Ø§Ù† ØªÙ‡Ø±Ø§Ù† (UTC+3:30)
          now_iran = datetime.utcnow() + timedelta(hours=3, minutes=30)
          today_ir = now_iran.strftime("%Y/%m/%d - %H:%M (Tehran)")

          msg = """ðŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ² Ø¨Ø§Ø²Ø§Ø± Ø·Ù„Ø§ØŒ Ø§Ø±Ø² Ùˆ Ø±Ù…Ø²Ø§Ø±Ø²Ù‡Ø§
          ðŸ—“ï¸ Ø¯ÙˆØ´Ù†Ø¨Ù‡ Û²Û¶ Ù…Ù‡Ø± Û±Û´Û°Û´ | Û±Û¸ Ø§Ú©ØªØ¨Ø± Û²Û°Û²Ûµ â€“ Ø³Ø§Ø¹Øª Û²Û±:Û°Û°

          ðŸŸ¡ Ø¨Ø§Ø²Ø§Ø± Ø·Ù„Ø§
          Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±: Û±Û°,Û¸Û´Û°,Û¸Û°Û° ØªÙˆÙ…Ø§Ù†
          Ø³Ú©Ù‡ Ø§Ù…Ø§Ù…ÛŒ: Û±Û±Û³,Û±Û¸Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†
          Ù†ÛŒÙ…â€ŒØ³Ú©Ù‡: ÛµÛ¸,Û´Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù† | Ø±Ø¨Ø¹â€ŒØ³Ú©Ù‡: Û³Û²,Û´Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†

          ðŸ’µ Ø¨Ø§Ø²Ø§Ø± Ø§Ø±Ø²
          Ø¯Ù„Ø§Ø±: Û±Û°Û¸,Û°Û°Û° ØªÙˆÙ…Ø§Ù† | ÛŒÙˆØ±Ùˆ: Û±Û²Ûµ,Û¹Û°Û° ØªÙˆÙ…Ø§Ù† | Ø¯Ø±Ù‡Ù…: â€”
          Ø­Ø¬Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù†Ø³Ø¨Øª Ø¨Ù‡ Ø¯ÛŒØ±ÙˆØ²: â€”Ùª

          ðŸª™ Ø¨Ø§Ø²Ø§Ø± Ø±Ù…Ø²Ø§Ø±Ø²Ù‡Ø§
          Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ†: Û±Û°Û¶,Û¹Û°Û° Ø¯Ù„Ø§Ø± | Ø§ØªØ±ÛŒÙˆÙ…: Û³,Û¸Û¸Û° Ø¯Ù„Ø§Ø±
          Ø³ÙˆÙ„Ø§Ù†Ø§: Û±Û¸Û¶ Ø¯Ù„Ø§Ø± | ØªØªØ±: Û±Û°Û¸,Û°Û°Û° ØªÙˆÙ…Ø§Ù†

          (Ø§Ø±Ø³Ø§Ù„ Ø®ÙˆØ¯Ú©Ø§Ø± GitHub Actions â€“ %s)
          """ % today_ir

          # Ø®Ø±ÙˆØ¬ÛŒ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø±Ø§ÛŒ step Ø¨Ø¹Ø¯ÛŒ
          with open(os.environ['GITHUB_OUTPUT'],'a',encoding='utf-8') as out:
              out.write("message=" + json.dumps(msg) + "\n")
          PY

      - name: Send to Telegram
        run: |
          curl -sS -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -H "Content-Type: application/json" \
            -d "{\"chat_id\":\"${{ secrets.TELEGRAM_CHAT_ID }}\",\"text\":${{ steps.build.outputs.message }},\"parse_mode\":\"HTML\",\"disable_web_page_preview\":true}"
