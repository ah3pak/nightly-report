name: Daily Telegram Report

on:
  schedule:
    # Ù‡Ø± Ø±ÙˆØ² 17:30 UTC â‰ˆ Ø³Ø§Ø¹Øª 21:00 ØªÙ‡Ø±Ø§Ù†
    - cron: "30 17 * * *"
  workflow_dispatch: {}   # Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ Ø¨Ø±Ø§ÛŒ ØªØ³Øª

jobs:
  send:
    runs-on: ubuntu-latest

    steps:
      - name: Build message (inline)
        id: build
        run: |
          TODAY_IR="$(date -u -d '+3 hours 30 minutes' '+%Y/%m/%d - %H:%M (Tehran)')"
          cat > msg.txt <<EOF
ðŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ø±ÙˆØ² Ø¨Ø§Ø²Ø§Ø± Ø·Ù„Ø§ØŒ Ø§Ø±Ø² Ùˆ Ø±Ù…Ø²Ø§Ø±Ø²Ù‡Ø§
ðŸ—“ï¸ Ø¯ÙˆØ´Ù†Ø¨Ù‡ Û²Û¶ Ù…Ù‡Ø± Û±Û´Û°Û´ | Û±Û¸ Ø§Ú©ØªØ¨Ø± Û²Û°Û²Ûµ â€“ Ø³Ø§Ø¹Øª Û²Û±:Û°Û°

ðŸŸ¡ Ø¨Ø§Ø²Ø§Ø± Ø·Ù„Ø§
Ø·Ù„Ø§ÛŒ Û±Û¸ Ø¹ÛŒØ§Ø±: Û±Û°,Û¸Û´Û°,Û¸Û°Û° ØªÙˆÙ…Ø§Ù†
Ø³Ú©Ù‡ Ø§Ù…Ø§Ù…ÛŒ: Û±Û±Û³,Û±Û¸Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†
Ù†ÛŒÙ…â€ŒØ³Ú©Ù‡: ÛµÛ¸,Û´Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù† | Ø±Ø¨Ø¹â€ŒØ³Ú©Ù‡: Û³Û²,Û´Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†

ðŸ’µ Ø¨Ø§Ø²Ø§Ø± Ø§Ø±Ø²
Ø¯Ù„Ø§Ø±: Û±Û°Û¸,Û°Û°Û° ØªÙˆÙ…Ø§Ù† | ÛŒÙˆØ±Ùˆ: Û±Û²Ûµ,Û¹Û°Û° ØªÙˆÙ…Ø§Ù† | Ø¯Ø±Ù‡Ù…: â€”
Ø­Ø¬Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù†Ø³Ø¨Øª Ø¨Ù‡ Ø¯ÛŒØ±ÙˆØ²: â€”Ùª

ðŸª™ Ø¨Ø§Ø²Ø§Ø± Ø±Ù…Ø²Ø§Ø±Ø²Ù‡Ø§
Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ†: Û±Û°Û¶,Û¹Û°Û° Ø¯Ù„Ø§Ø± | Ø§ØªØ±ÛŒÙˆÙ…: Û³,Û¸Û¸Û° Ø¯Ù„Ø§Ø±
Ø³ÙˆÙ„Ø§Ù†Ø§: Û±Û¸Û¶ Ø¯Ù„Ø§Ø± | ØªØªØ±: Û±Û°Û¸,Û°Û°Û° ØªÙˆÙ…Ø§Ù†

(Ø§Ø±Ø³Ø§Ù„ Ø®ÙˆØ¯Ú©Ø§Ø± GitHub Actions â€“ $TODAY_IR)
EOF

          python3 - <<'PY'
import json, os
with open('msg.txt','r',encoding='utf-8') as f:
    msg = f.read()
# Ù†ÙˆØ´ØªÙ† Ø®Ø±ÙˆØ¬ÛŒ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ù‡ GITHUB_OUTPUT (Ø§ÛŒÙ…Ù† Ùˆ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯)
with open(os.environ['GITHUB_OUTPUT'],'a',encoding='utf-8') as out:
    out.write("message=" + json.dumps(msg) + "\n")
PY

      - name: Send to Telegram
        run: |
          curl -sS -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -H "Content-Type: application/json" \
            -d "{\"chat_id\":\"${{ secrets.TELEGRAM_CHAT_ID }}\",\"text\":${{ steps.build.outputs.message }},\"parse_mode\":\"HTML\",\"disable_web_page_preview\":true}"
